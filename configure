#!/bin/sh
set -eu

base='-lcrypt'
libs='libcrypto libtls'
[ "$(uname)" = 'Darwin' ] && base=

exec >config.mk

pkg-config --print-errors $libs

cat <<EOF
CFLAGS += $(pkg-config --cflags $libs)
LDFLAGS += $(pkg-config --libs-only-L $libs)
LDLIBS = ${base} $(pkg-config --libs-only-l $libs)
CFLAGS += -D'OPENSSL_BIN="$(pkg-config --variable=exec_prefix openssl)/bin/openssl"'
CFLAGS += -D'CERTBOT_PATH="/etc/letsencrypt"'
INSTALLS =
EOF

if [ "$(uname)" = 'Linux' ]; then
	cat <<-EOF
	CFLAGS += -D_GNU_SOURCE
	LDLIBS.calico = \${LDLIBS}
	EOF
fi
